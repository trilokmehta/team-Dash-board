<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Lumina - Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Inter", sans-serif;
      }
      .no-scrollbar::-webkit-scrollbar {
        display: none;
      }
      .no-scrollbar {
        -ms-overflow-style: none;
        scrollbar-width: none;
      }
      .glass-panel {
        background: rgba(255, 255, 255, 0.03);
        backdrop-filter: blur(16px);
        border: 1px solid rgba(255, 255, 255, 0.08);
        box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
      }
      .news-item:hover {
        background: rgba(255, 255, 255, 0.05);
      }
    </style>
  </head>
  <body
    class="bg-[#0a0a0c] text-slate-200 font-sans min-h-screen selection:bg-indigo-500/30 overflow-hidden flex"
  >
    <div
      class="fixed top-0 left-0 w-full h-full overflow-hidden -z-10 pointer-events-none"
    >
      <div
        class="absolute top-[-10%] left-[-10%] w-[40%] h-[40%] bg-indigo-600/20 blur-[120px] rounded-full"
      ></div>
      <div
        class="absolute bottom-[-10%] right-[-10%] w-[40%] h-[40%] bg-purple-600/10 blur-[120px] rounded-full"
      ></div>
    </div>

    <nav
      class="w-20 xl:w-72 border-r border-white/5 bg-black/20 backdrop-blur-xl p-4 flex flex-col items-center xl:items-start gap-6 transition-all duration-300 h-screen flex-shrink-0 z-50"
    >
      <div
        class="flex items-center gap-3 px-2 mb-2 w-full justify-center xl:justify-start"
      >
        <div
          class="w-10 h-10 rounded-xl bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center shadow-lg shadow-indigo-500/20 flex-shrink-0"
        >
          <i data-lucide="zap" class="text-white fill-white w-5 h-5"></i>
        </div>
        <span
          class="text-xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-white to-slate-400 hidden xl:block tracking-tight"
          >Lumina</span
        >
      </div>
      <div
        class="flex flex-col gap-2 w-full flex-1 overflow-y-auto no-scrollbar pr-1"
      >
        <a
          href="index.html"
          class="flex items-center gap-4 px-4 py-3.5 rounded-2xl w-full bg-indigo-600 text-white shadow-lg shadow-indigo-600/20"
          ><i data-lucide="layout-dashboard" class="w-5 h-5"></i
          ><span class="text-sm font-medium hidden xl:block">Dashboard</span></a
        >
        <a
          href="finance.html"
          class="flex items-center gap-4 px-4 py-3.5 rounded-2xl w-full text-slate-500 hover:bg-white/5 hover:text-slate-300 transition-all"
          ><i data-lucide="trending-up" class="w-5 h-5"></i
          ><span class="text-sm font-medium hidden xl:block">Finance</span></a
        >
        <a
          href="mywork.html"
          class="flex items-center gap-4 px-4 py-3.5 rounded-2xl w-full text-slate-500 hover:bg-white/5 hover:text-slate-300 transition-all"
          ><i data-lucide="kanban-square" class="w-5 h-5"></i
          ><span class="text-sm font-medium hidden xl:block">My Work</span></a
        >
        <a
          href="worklog.html"
          class="flex items-center gap-4 px-4 py-3.5 rounded-2xl w-full text-slate-500 hover:bg-white/5 hover:text-slate-300 transition-all"
          ><i data-lucide="notebook-pen" class="w-5 h-5"></i
          ><span class="text-sm font-medium hidden xl:block">Daily Log</span></a
        >
        <a
          href="files.html"
          class="flex items-center gap-4 px-4 py-3.5 rounded-2xl w-full text-slate-500 hover:bg-white/5 hover:text-slate-300 transition-all"
          ><i data-lucide="folder-open" class="w-5 h-5"></i
          ><span class="text-sm font-medium hidden xl:block"
            >Company Files</span
          ></a
        >
        <a
          href="passwords.html"
          class="flex items-center gap-4 px-4 py-3.5 rounded-2xl w-full text-slate-500 hover:bg-white/5 hover:text-slate-300 transition-all"
          ><i data-lucide="lock" class="w-5 h-5"></i
          ><span class="text-sm font-medium hidden xl:block"
            >IDs & Passwords</span
          ></a
        >
        <a
          href="monitoring.html"
          class="flex items-center gap-4 px-4 py-3.5 rounded-2xl w-full text-slate-500 hover:bg-white/5 hover:text-slate-300 transition-all"
          ><i data-lucide="activity" class="w-5 h-5"></i
          ><span class="text-sm font-medium hidden xl:block"
            >Monitoring</span
          ></a
        >
        <a
          href="chats.html"
          class="flex items-center gap-4 px-4 py-3.5 rounded-2xl w-full text-slate-500 hover:bg-white/5 hover:text-slate-300 mt-auto transition-all"
          ><i data-lucide="message-square" class="w-5 h-5"></i
          ><span class="text-sm font-medium hidden xl:block">Chats</span></a
        >
      </div>
    </nav>

    <main class="flex-1 flex flex-col h-screen overflow-hidden relative">
      <header
        class="flex-shrink-0 h-20 px-8 flex items-center justify-between border-b border-white/5 bg-[#0a0a0c]/80 backdrop-blur-sm z-10"
      >
        <div>
          <h1 class="text-2xl font-bold text-white tracking-tight">Overview</h1>
          <p id="date-text" class="text-xs text-slate-500 mt-1">
            Loading date...
          </p>
        </div>
      </header>

      <div
        id="content-area"
        class="flex-1 overflow-y-auto p-8 scroll-smooth no-scrollbar"
      >
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
          <div
            class="lg:col-span-1 glass-panel rounded-[32px] p-8 flex flex-col justify-between relative overflow-hidden h-72"
          >
            <div class="flex justify-between items-start z-10">
              <div
                class="w-12 h-12 rounded-2xl bg-amber-500/10 flex items-center justify-center border border-amber-500/20 text-amber-500"
              >
                <i data-lucide="sun" class="w-6 h-6"></i>
              </div>
              <div class="text-right">
                <p
                  id="dash-clock"
                  class="text-4xl font-light text-white leading-none tracking-tighter"
                >
                  --:--
                </p>
                <p
                  class="text-slate-500 text-xs mt-1 uppercase tracking-widest"
                >
                  Local Time
                </p>
              </div>
            </div>
            <div class="mt-auto z-10">
              <div class="flex items-end gap-1 mb-4">
                <span id="dash-temp" class="text-6xl font-bold text-white"
                  >--°</span
                ><span class="text-slate-400 text-xl mb-3">C</span>
              </div>
              <div
                class="bg-black/40 rounded-xl p-3 border border-white/5 backdrop-blur-sm"
              >
                <div class="flex justify-between items-center mb-2">
                  <div class="flex items-center gap-2">
                    <i data-lucide="wind" class="w-3 h-3 text-slate-400"></i
                    ><span
                      class="text-xs text-slate-300 font-bold uppercase tracking-wider"
                      >Air Quality</span
                    >
                  </div>
                  <span id="aqi-text" class="font-bold text-sm text-slate-400"
                    >-- AQI</span
                  >
                </div>
                <div
                  class="h-1.5 w-full bg-white/10 rounded-full overflow-hidden mb-2"
                >
                  <div
                    id="aqi-bar"
                    class="h-full rounded-full bg-slate-500"
                    style="width: 0%"
                  ></div>
                </div>
              </div>
            </div>
            <div
              class="absolute -right-10 -top-10 w-40 h-40 bg-amber-500/20 blur-[60px] rounded-full"
            ></div>
          </div>

          <div
            class="lg:col-span-2 glass-panel rounded-[32px] p-8 relative overflow-hidden group h-72 flex flex-col justify-center"
          >
            <div
              class="absolute top-0 right-0 w-full h-full bg-gradient-to-br from-indigo-600/10 to-transparent"
            ></div>
            <div class="relative z-10">
              <h2 class="text-2xl font-semibold text-white mb-2">
                Task Completion
              </h2>
              <p class="text-slate-400 mb-6">
                You have completed
                <span id="done-count" class="text-indigo-400 font-bold">0</span>
                tasks total.
              </p>
              <div
                class="h-4 w-full bg-black/40 rounded-full overflow-hidden border border-white/5"
              >
                <div
                  id="progress-bar"
                  class="h-full w-[0%] bg-gradient-to-r from-indigo-500 to-purple-500 shadow-[0_0_15px_rgba(99,102,241,0.5)] transition-all duration-1000"
                ></div>
              </div>
              <div
                class="flex justify-between mt-3 text-xs font-bold text-slate-500 uppercase tracking-wider"
              >
                <span id="progress-text">0% Complete</span>
                <span id="total-count">Total: 0</span>
              </div>
            </div>
          </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
          <div class="glass-panel p-6 rounded-3xl border-l-4 border-indigo-500">
            <p class="text-slate-500 text-xs font-bold uppercase mb-2">
              Total Revenue
            </p>
            <h3 id="stat-revenue" class="text-2xl font-bold text-white">
              $...
            </h3>
          </div>
          <div
            class="glass-panel p-6 rounded-3xl border-l-4 border-emerald-500"
          >
            <p class="text-slate-500 text-xs font-bold uppercase mb-2">
              Completed Tasks
            </p>
            <h3 id="stat-completed" class="text-2xl font-bold text-white">
              ...
            </h3>
          </div>
          <div class="glass-panel p-6 rounded-3xl border-l-4 border-rose-500">
            <p class="text-slate-500 text-xs font-bold uppercase mb-2">
              Pending Tasks
            </p>
            <h3 id="stat-pending" class="text-2xl font-bold text-white">...</h3>
          </div>
          <div class="glass-panel p-6 rounded-3xl border-l-4 border-amber-500">
            <p class="text-slate-500 text-xs font-bold uppercase mb-2">
              Work Logs
            </p>
            <h3 id="stat-logs" class="text-2xl font-bold text-white">...</h3>
          </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
          <div
            class="lg:col-span-1 glass-panel rounded-3xl p-6 flex flex-col h-[500px]"
          >
            <div class="flex items-center justify-between mb-4">
              <h3 class="font-bold text-white text-lg flex items-center gap-2">
                <i data-lucide="bell-ring" class="w-5 h-5 text-indigo-400"></i
                >Notices
              </h3>
            </div>
            <div class="flex-1 overflow-y-auto no-scrollbar space-y-4 pr-1">
              <div class="bg-white/5 p-4 rounded-xl border border-white/5">
                <p class="text-sm font-semibold text-slate-200">System Ready</p>
                <p class="text-xs text-slate-400 mt-1">
                  Dashboard is now connected to live Supabase data.
                </p>
              </div>
            </div>
          </div>

          <div
            class="lg:col-span-2 glass-panel rounded-3xl p-6 flex flex-col h-[500px]"
          >
            <div class="flex items-center justify-between mb-4">
              <h3 class="font-bold text-white text-lg flex items-center gap-2">
                <i data-lucide="globe" class="w-5 h-5 text-emerald-400"></i>
                Tech News
              </h3>
              <button
                onclick="fetchNews()"
                class="p-1.5 hover:bg-white/10 rounded-lg text-slate-400"
              >
                <i data-lucide="refresh-cw" class="w-4 h-4"></i>
              </button>
            </div>
            <div
              id="news-container"
              class="flex-1 overflow-y-auto no-scrollbar space-y-3 pr-1"
            ></div>
          </div>
        </div>
      </div>
    </main>

<script>
  lucide.createIcons();

  // 1. Credentials
  const SUPABASE_URL = "https://jwrgsmluqhqlxizsuyzc.supabase.co";
  const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imp3cmdzbWx1cWhxbHhpenN1eXpjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjczNjQ1OTYsImV4cCI6MjA4Mjk0MDU5Nn0.daGg1TXP3JjrkQeEodEPBY97ThfFRH3cppETLTWUl8Y";

  // 2. Initialize the client safely
  // We use window.lumina to avoid any naming conflicts with the global 'supabase' object from the CDN
  if (!window.lumina) {
      window.lumina = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
  }

  // 3. Fetch Dashboard Stats
  async function loadStats() {
    try {
      // --- Revenue ---
      const { data: txData, error: txError } = await window.lumina
        .from('transactions')
        .select('amount, type');
      
      if (txError) throw txError;
      
      const revenue = txData
        ?.filter((t) => t.type === "credit")
        .reduce((sum, t) => sum + parseFloat(t.amount || 0), 0) || 0;
      
      document.getElementById("stat-revenue").innerText = `₹${revenue.toLocaleString()}`;

      // --- Tasks ---
      const { data: tasks, error: taskError } = await window.lumina
        .from("tasks")
        .select("status");
      
      if (taskError) throw taskError;

      const total = tasks?.length || 0;
      const done = tasks?.filter((t) => t.status === "Done").length || 0;
      const pending = total - done;

      document.getElementById("stat-completed").innerText = done;
      document.getElementById("stat-pending").innerText = pending;
      document.getElementById("done-count").innerText = done;
      document.getElementById("total-count").innerText = `Total: ${total}`;

      // --- Progress Bar ---
      const pct = total > 0 ? Math.round((done / total) * 100) : 0;
      document.getElementById("progress-bar").style.width = `${pct}%`;
      document.getElementById("progress-text").innerText = `${pct}% Complete`;

      // --- Work Logs ---
      const { count, error: logError } = await window.lumina
        .from("work_logs")
        .select("*", { count: "exact", head: true });
      
      if (logError) throw logError;
      document.getElementById("stat-logs").innerText = count || 0;

    } catch (error) {
      console.error("Supabase Sync Error:", error.message);
      // Optional: Visual indicator of error
      document.getElementById("stat-revenue").innerText = "Error";
    }
  }

  // 4. Clock & Date
  function updateClock() {
    const now = new Date();
    const dateEl = document.getElementById("date-text");
    if(dateEl) {
        dateEl.innerText = now.toLocaleDateString("en-US", { weekday: "long", month: "long", day: "numeric" });
    }
    
    const clockEl = document.getElementById("dash-clock");
    if (clockEl) {
        clockEl.innerText = now.toLocaleTimeString([], { hour: "2-digit", minute: "2-digit" });
    }
  }

  // 5. Weather
  async function fetchWeatherData() {
    try {
      const wRes = await fetch("https://api.open-meteo.com/v1/forecast?latitude=28.6139&longitude=77.2090&current=temperature_2m&timezone=auto");
      const wData = await wRes.json();
      document.getElementById("dash-temp").innerText = Math.round(wData.current.temperature_2m) + "°";

      const aqiRes = await fetch("https://air-quality-api.open-meteo.com/v1/air-quality?latitude=28.6139&longitude=77.2090&current=us_aqi&timezone=auto");
      const aqiData = await aqiRes.json();
      const aqi = aqiData.current.us_aqi;
      document.getElementById("aqi-text").innerText = `${aqi} US AQI`;
      document.getElementById("aqi-bar").style.width = `${Math.min((aqi / 300) * 100, 100)}%`;
    } catch (e) {
      console.error("Weather Error:", e);
    }
  }

  // 6. News
  async function fetchNews() {
    const container = document.getElementById("news-container");
    try {
      const res = await fetch(`https://api.rss2json.com/v1/api.json?rss_url=https://techcrunch.com/feed/`);
      const data = await res.json();
      if (data.status === "ok") {
        container.innerHTML = data.items.slice(0, 10).map(item => `
          <a href="${item.link}" target="_blank" class="block p-4 rounded-xl border border-white/5 hover:bg-white/5 transition-all">
            <h4 class="text-sm font-semibold text-slate-200 mb-1">${item.title}</h4>
            <div class="text-[10px] text-slate-500">${new Date(item.pubDate).toLocaleTimeString()}</div>
          </a>`).join("");
      }
    } catch (e) {
       console.error("News Error:", e);
    }
  }

  // Initialize everything
  setInterval(updateClock, 1000);
  updateClock();
  loadStats();
  fetchWeatherData();
  fetchNews();
</script>
  </body>
</html>
